openapi: 3.1.0
info:
    title: PaySaxas Customer API
    version: "1.0.0"
    description: |
        Customer-focused subset of the PaySaxas platform API exported from Confluence.
        Includes read-only retrieval, search, creation, and metadata updates for customers,
        plus webhook delivery contracts. Authentication uses bearer tokens for public
        endpoints and HMAC signatures for webhooks.
servers:
    -
        url: https://api.paysaxas.example/v1
        description: Example environment. Replace the hostname with the target deployment.
tags:
    -
        name: Customers
        description: Manage customer lifecycle records and metadata.
paths:
    /customers/{id}:
        get:
            summary: Retrieve Customer Details
            description: |
                Retrieves the full details of a specific customer by id, including lifecycle
                status and non-sensitive metadata. This endpoint is read-only - it never updates
                customer data or lifecycle state. Lifecycle transitions depend on internal
                onboarding flows and compliance checks.
            operationId: getCustomerById
            tags:
                - Customers
            security:
                -
                    BearerAuth: [ ]
            parameters:
                -
                    $ref: '#/components/parameters/CustomerId'
            responses:
                '200':
                    description: Successful response with customer details.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Customer'
                '400':
                    description: Validation error - the provided id does not match the expected pattern.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                            examples:
                                invalidId:
                                    value:
                                        error_name: Validation Error
                                        error_description: Invalid customer id format.
                                        metadata:
                                            trace_id: abc123
                                            details: "Field 'id' must match pattern 'cust_[0-9]{9}'"
                '401':
                    description: Unauthorized - authentication token missing or expired.
                '403':
                    description: Insufficient permissions - token lacks the required access scope.
                '404':
                    description: Customer not found - no record with the given id exists or it was deleted.
            x-notes:
                - Endpoint is read-only.
                - Lifecycle transitions are handled internally via system logic and compliance.
                - Each error payload includes a trace_id for debugging and log correlation.
                - All sample identifiers and metadata are illustrative only.
        patch:
            summary: Update Customer Metadata
            description: |
                Updates the `metadata` object for a specific customer. Lifecycle state, onboarding
                stage, and any personal, KYC, or KYB data remain immutable here. The response mirrors
                the canonical customer payload returned by creation and retrieval operations.
            operationId: updateCustomerMetadata
            tags:
                - Customers
            security:
                -
                    BearerAuth: [ ]
            parameters:
                -
                    $ref: '#/components/parameters/CustomerId'
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CustomerMetadataUpdateRequest'
                        examples:
                            updateMetadata:
                                value:
                                    metadata:
                                        created_by: partner-portal-url
                                        client_reference: crm-7890
            responses:
                '200':
                    description: Customer metadata successfully updated.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Customer'
                '400':
                    description: Validation error - invalid request body or forbidden fields supplied.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                            examples:
                                invalidMetadata:
                                    value:
                                        error_name: Validation Error
                                        error_description: Invalid metadata structure.
                                        metadata:
                                            trace_id: abc123
                                            details: "Field 'metadata' must be an object containing only 'created_by' and 'client_reference'."
                '401':
                    description: Unauthorized - authentication token missing or expired.
                '403':
                    description: Insufficient permissions - token lacks the required access scope.
                '404':
                    description: Customer not found - no record with the given id exists.
                '409':
                    description: Conflict - concurrent update detected; retry with the latest state.
            x-notes:
                - Only metadata fields are mutable with this operation.
                - Lifecycle fields and any KYC or personal data remain read-only.
                - Response shape matches POST and GET payloads for consistency.
                - All updates are auditable, capturing timestamp and operator identity.
    /customers:
        get:
            summary: List or Search Customers
            description: |
                Returns a paginated list of customers for dashboards and oversight. Results default
                to descending creation time. Returned objects are simplified; call `GET /customers/{id}`
                for full details. Customer lifecycle transitions remain governed by internal flows
                and compliance rules.
            operationId: listCustomers
            tags:
                - Customers
            security:
                -
                    BearerAuth: [ ]
            parameters:
                -
                    name: type
                    in: query
                    description: Filter by customer type.
                    required: false
                    schema:
                        type: string
                        enum: [ individual, business ]
                        example: business
                -
                    name: status
                    in: query
                    description: Filter by lifecycle stage.
                    required: false
                    schema:
                        type: string
                        enum: [ inactive, reserved, active, closed ]
                        example: active
                -
                    name: country
                    in: query
                    description: ISO 3166-1 alpha-2 country code.
                    required: false
                    schema:
                        type: string
                        example: DE
                -
                    name: cursor
                    in: query
                    description: |
                        Cursor token for pagination. Use the `next_cursor` value from the prior response to
                        fetch the next page. Offset-based pagination is not supported.
                    required: false
                    schema:
                        type: string
                        example: eyJwYWdlIjoyfQ==
                -
                    name: limit
                    in: query
                    description: Optional page size when using cursor pagination (default 20, maximum 100).
                    required: false
                    schema:
                        type: integer
                        minimum: 1
                        maximum: 100
                        example: 20
            responses:
                '200':
                    description: Successful response with a paginated customer list.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/CustomerListResponse'
                '400':
                    description: Validation error - one or more query parameters are invalid or unsupported.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                            examples:
                                invalidStatus:
                                    value:
                                        error_name: Validation Error
                                        error_description: Invalid status filter.
                                        metadata:
                                            trace_id: abc123
                                            details: "Allowed values: inactive, reserved, active, closed."
                '401':
                    description: Unauthorized - authentication token missing or expired.
                '403':
                    description: Insufficient permissions - token lacks the required access scope.
            x-notes:
                - Endpoint is read-only and cannot modify customer states.
                - Pagination relies exclusively on cursors; always pass `next_cursor` for subsequent pages.
                - When filters are omitted results are sorted by descending creation date.
                - Every error response includes a trace identifier for diagnostics.
                - All example payloads use fictional data.
        post:
            summary: Create a Customer
            description: |
                Creates a new customer record - either individual or business - and initialises it in the
                `pre_registration` lifecycle stage. This is the first onboarding step. After creation,
                lifecycle transitions are handled internally: individuals progress automatically, while
                business customers move through manual compliance review. This endpoint never accepts or
                exposes KYC or KYB data.
            operationId: createCustomer
            tags:
                - Customers
            security:
                -
                    BearerAuth: [ ]
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/CustomerCreateRequest'
                        examples:
                            createCustomer:
                                value:
                                    type: business
                                    email: ops@acme.example
                                    reference_id: ext-ACME001
                                    metadata:
                                        created_by: partner-portal-url
                                        client_reference: crm-7890
            responses:
                '201':
                    description: Customer successfully created.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/Customer'
                '400':
                    description: Validation error - missing or invalid required fields.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                            examples:
                                missingEmail:
                                    value:
                                        error_name: Validation Error
                                        error_description: "Missing required field: email"
                                        metadata:
                                            trace_id: abc123
                                            details: "Field 'email' is mandatory."
                '401':
                    description: Unauthorized - authentication token missing or expired.
                '403':
                    description: Insufficient permissions - token lacks the required access scope.
                '409':
                    description: Duplicate customer - an existing record already uses this email address.
                    content:
                        application/json:
                            schema:
                                $ref: '#/components/schemas/ErrorResponse'
                            examples:
                                duplicateEmail:
                                    value:
                                        error_name: Duplicate Customer
                                        error_description: Customer with this email already exists.
                                        metadata:
                                            trace_id: xyz321
            x-notes:
                - Newly created customers always begin in the `pre_registration` lifecycle stage.
                - The `status` field is managed internally and cannot be set directly.
                - No KYC or KYB payloads are accepted.
                - Use unique `reference_id` and `metadata.client_reference` values for reconciliation.
                - All sample payloads use fictional data.
webhooks:
    customers:
        post:
            summary: Customer Webhooks
            description: |
                Customer lifecycle webhooks emit creation, status-change, and suspension events. Each webhook
                carries only the customer id in the body, while the event type is conveyed through the
                `X-Event` header. Always fetch full context via `GET /customers/{id}` after receiving a
                webhook notification.
            tags:
                - Customers
            security:
                -
                    HMACSignature: [ ]
            headers:
                X-Event:
                    description: Identifies the webhook event type.
                    required: true
                    schema:
                        type: string
                        enum: [ customer.created, customer.status.changed, customer.suspended ]
                        example: customer.created
                X-Signature:
                    description: HMAC SHA-256 signature in the form `sha256=<hex>` for authenticity checks.
                    required: true
                    schema:
                        type: string
                        example: sha256=f28b1e7c4df9...
                X-Request-Id:
                    description: Unique webhook delivery identifier for deduplication.
                    required: true
                    schema:
                        type: string
                        example: req_9a7c4e2f
                Date:
                    description: UTC timestamp when the webhook was generated. Reject payloads older than five minutes to prevent replay attacks.
                    required: true
                    schema:
                        type: string
                        example: Wed, 05 Nov 2025 12:45:30 GMT
                Content-Type:
                    description: Payload media type.
                    required: true
                    schema:
                        type: string
                        example: application/json
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            $ref: '#/components/schemas/WebhookPayload'
                        examples:
                            created:
                                value:
                                    id: cust_123456789
            responses:
                '200':
                    description: Successful delivery acknowledgement.
                '204':
                    description: Successful delivery acknowledgement with no response body.
                '400':
                    description: Invalid payload or malformed signature.
                '401':
                    description: Unauthorized - missing or invalid signature.
                '403':
                    description: Forbidden - timestamp outside the allowed window or signature validation failed.
                '5XX':
                    description: Temporary server error - delivery will be retried.
            x-examples:
                -
                    summary: customer.created
                    value:
                        headers:
                            X-Event: customer.created
                            X-Signature: sha256=f28b1e7c4df9...
                            X-Request-Id: req_9a7c4e2f
                            Date: Wed, 05 Nov 2025 12:45:30 GMT
                            Content-Type: application/json
                        body:
                            id: cust_123456789
                -
                    summary: customer.status.changed
                    value:
                        headers:
                            X-Event: customer.status.changed
                            X-Signature: sha256=ad6b4d8fca7a...
                            X-Request-Id: req_b481aa94
                            Date: Wed, 05 Nov 2025 13:10:02 GMT
                            Content-Type: application/json
                        body:
                            id: cust_987654321
                -
                    summary: customer.suspended
                    value:
                        headers:
                            X-Event: customer.suspended
                            X-Signature: sha256=bea7938c9a10...
                            X-Request-Id: req_73fcd832
                            Date: Wed, 05 Nov 2025 13:40:00 GMT
                            Content-Type: application/json
                        body:
                            id: cust_456789123
            x-delivery:
                retries: 3
                retry_window: 24h
                backoff_strategy: exponential
                success_statuses: [ 200, 204 ]
            x-notes:
                - Webhook payloads contain only the customer id.
                - Always inspect the `X-Event` header to determine the event type.
                - Respond within five seconds; otherwise deliveries are retried up to three times within twenty four hours.
                - Use `X-Request-Id` for deduplication and replay prevention.
                - Validate `X-Signature` together with the Date header to prevent spoofing or replay attacks.
                - Webhooks never include personal, financial, or KYC/KYB data.
                - Fetch `GET /customers/{id}` after each webhook to obtain the latest state.
components:
    parameters:
        CustomerId:
            name: id
            in: path
            required: true
            description: Unique PaySaxas customer identifier.
            schema:
                type: string
                example: cust_123456789
    securitySchemes:
        BearerAuth:
            type: http
            scheme: bearer
            bearerFormat: JWT
        HMACSignature:
            type: apiKey
            in: header
            name: X-Signature
    schemas:
        Customer:
            type: object
            description: Full customer representation with immutable lifecycle fields.
            properties:
                id:
                    type: string
                    description: Unique PaySaxas customer identifier.
                    example: cust_123456789
                type:
                    type: string
                    description: Customer type classification.
                    enum: [ individual, business ]
                    example: individual
                reference_id:
                    type: string
                    description: External partner or CRM reference supplied by integrators.
                    example: ext-12345
                email:
                    type: string
                    format: email
                    description: Customer contact email.
                    example: ops@acme.example
                status:
                    type: string
                    description: Customer lifecycle status.
                    enum: [ inactive, reserved, pre_registration, active, closed ]
                    example: active
                country:
                    type: string
                    description: ISO 3166-1 alpha-2 country code when available.
                    example: DE
                created_at:
                    type: string
                    format: date-time
                    description: Timestamp when the customer record was created (ISO 8601, UTC).
                    example: "2025-10-21T08:00:00Z"
                updated_at:
                    type: string
                    format: date-time
                    description: Timestamp of the latest modification (ISO 8601, UTC).
                    example: "2025-10-23T11:45:00Z"
                metadata:
                    $ref: '#/components/schemas/CustomerMetadata'
            required: [ id, type, status, created_at, updated_at, metadata ]
        CustomerSummary:
            type: object
            description: Lightweight customer projection returned by list endpoints.
            properties:
                id:
                    type: string
                    description: Unique PaySaxas customer identifier.
                    example: cust_123456789
                type:
                    type: string
                    enum: [ individual, business ]
                    description: Customer type classification.
                    example: business
                status:
                    type: string
                    enum: [ inactive, reserved, active, closed ]
                    description: Current lifecycle status.
                    example: active
                country:
                    type: string
                    description: ISO 3166-1 alpha-2 country code.
                    example: DE
                created_at:
                    type: string
                    format: date-time
                    description: Creation timestamp (ISO 8601, UTC).
                    example: "2025-10-21T08:00:00Z"
                updated_at:
                    type: string
                    format: date-time
                    description: Last modification timestamp (ISO 8601, UTC).
                    example: "2025-10-23T11:45:00Z"
            required: [ id, type, status, created_at, updated_at ]
        CustomerMetadata:
            type: object
            description: Non-sensitive metadata used for CRM reconciliation.
            properties:
                created_by:
                    type: string
                    description: Source system that initiated or last updated the customer.
                    example: partner-portal-url
                client_reference:
                    type: string
                    description: Optional client-side reference linking internal systems.
                    example: crm-7890
            additionalProperties: false
        CustomerListResponse:
            type: object
            properties:
                data:
                    type: array
                    description: Customers included in the current page.
                    items:
                        $ref: '#/components/schemas/CustomerSummary'
                pagination:
                    $ref: '#/components/schemas/Pagination'
            required: [ data, pagination ]
        Pagination:
            type: object
            description: Cursor-based pagination metadata.
            properties:
                next_cursor:
                    type: string
                    description: Token to retrieve the next page of results.
                    example: eyJwYWdlIjoyfQ==
                limit:
                    type: integer
                    description: Number of results requested per page.
                    example: 20
            required: [ limit ]
        CustomerCreateRequest:
            type: object
            required: [ type, email ]
            properties:
                type:
                    type: string
                    enum: [ individual, business ]
                    description: Customer type.
                    example: business
                email:
                    type: string
                    format: email
                    description: Unique email address used for registration and communication.
                    example: ops@acme.example
                reference_id:
                    type: string
                    description: External partner reference such as a CRM or affiliate identifier.
                    example: ext-ACME001
                metadata:
                    $ref: '#/components/schemas/CustomerMetadata'
        CustomerMetadataUpdateRequest:
            type: object
            required: [ metadata ]
            properties:
                metadata:
                    $ref: '#/components/schemas/CustomerMetadata'
        WebhookPayload:
            type: object
            required: [ id ]
            properties:
                id:
                    type: string
                    description: Unique PaySaxas customer identifier.
                    example: cust_123456789
        ErrorResponse:
            type: object
            properties:
                error_name:
                    type: string
                    description: Machine readable error name.
                    example: Validation Error
                error_description:
                    type: string
                    description: Human readable error detail.
                    example: Invalid status filter.
                metadata:
                    type: object
                    description: Diagnostic metadata accompanying the error.
                    properties:
                        trace_id:
                            type: string
                            description: Unique trace identifier for debugging purposes.
                            example: abc123
                        details:
                            type: string
                            description: Optional extended context.
                    required: [ trace_id ]
            required: [ error_name, error_description ]
