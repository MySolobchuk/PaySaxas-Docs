openapi: 3.0.3
info:
    title: PaySaxas Open Banking API (Basic Scope)
    version: "1.0.0"
    description: |
        Специфікація складена з офіційної сторінки PaySaxas OpenAPI.
        Базова структура: https://mb5openapi.{hostname}/{version}/{type}/{command}
        Усі методи — POST з JSON у тілі. Формат дат: YYYYMMDD.
        Опис охоплює ключові домени:
          * Customers — створення, пошук, перегляд та вебхуки життєвого циклу клієнтів.
          * Accounts & IBANs — керування рахунками, пов’язаними IBAN та подіями вебхуків.
          * Transactions — операції та їх події, включаючи статуси обробки та розрахунку.
          * Webhooks — єдина модель підписів, заголовків безпеки та політик повторної доставки.
servers:
    -
        url: https://mb5openapi.{hostname}/{version}
        variables:
            hostname:
                default: example.com
                description: Домен ASPSP
            version:
                default: v100
                description: Версія API у форматі vxxx
security:
    -
        bearerAuth: [ ]
tags:
    - name: Accounts
      description: Operations for managing accounts, IBANs, and related webhooks.
    - name: Customers
      description: Customer lifecycle, metadata, and customer webhooks.
    - name: Transactions
      description: Transaction retrieval and transaction webhook notifications.
components:
    parameters:
        CustomerId:
            name: id
            in: path
            required: true
            description: Unique PaySaxas customer identifier.
            schema:
                type: string
                example: cust_123456789
        AccountsXEventHeader:
            name: X-Event
            in: header
            required: true
            description: Event type for account and IBAN webhook deliveries.
            schema:
                type: string
                example: account.created
        TransactionsXEventHeader:
            name: X-Event
            in: header
            required: true
            description: Event type for transaction webhook deliveries.
            schema:
                type: string
                example: transaction.completed
        CustomersXEventHeader:
            name: X-Event
            in: header
            required: true
            description: Identifies the customer webhook event type.
            schema:
                type: string
                enum: [ customer.created, customer.status.changed, customer.suspended ]
                example: customer.created
        XSignatureHeader:
            name: X-Signature
            in: header
            required: true
            description: HMAC SHA-256 signature of the raw webhook body using the shared secret.
            schema:
                type: string
                example: sha256=f28b1e7c4df9...
        XRequestIdHeader:
            name: X-Request-Id
            in: header
            required: true
            description: UUIDv4 identifier used for deduplication and idempotency.
            schema:
                type: string
                example: req_9a7c4e2f
        DateHeader:
            name: Date
            in: header
            required: true
            description: UTC timestamp for replay protection (reject skew greater than five minutes).
            schema:
                type: string
                example: Wed, 05 Nov 2025 12:45:30 GMT
        JsonContentTypeHeader:
            name: Content-Type
            in: header
            required: true
            description: Payload media type, always `application/json`.
            schema:
                type: string
                example: application/json
    securitySchemes:
        bearerAuth:
            type: http
            scheme: bearer
            bearerFormat: JWT
        HMACSignature:
            type: apiKey
            in: header
            name: X-Signature
    schemas:
        Customer:
            type: object
            description: Full customer representation with immutable lifecycle fields.
            properties:
                id:
                    type: string
                    description: Unique PaySaxas customer identifier.
                    example: cust_123456789
                type:
                    type: string
                    description: Customer type classification.
                    enum: [ individual, business ]
                    example: individual
                reference_id:
                    type: string
                    description: External partner or CRM reference supplied by integrators.
                    example: ext-12345
                email:
                    type: string
                    format: email
                    description: Customer contact email.
                    example: ops@acme.example
                status:
                    type: string
                    description: Customer lifecycle status.
                    enum: [ inactive, reserved, pre_registration, active, closed ]
                    example: active
                country:
                    type: string
                    description: ISO 3166-1 alpha-2 country code when available.
                    example: DE
                created_at:
                    type: string
                    format: date-time
                    description: Timestamp when the customer record was created (ISO 8601, UTC).
                    example: "2025-10-21T08:00:00Z"
                updated_at:
                    type: string
                    format: date-time
                    description: Timestamp of the latest modification (ISO 8601, UTC).
                    example: "2025-10-23T11:45:00Z"
                metadata:
                    $ref: '#/components/schemas/CustomerMetadata'
            required: [ id, type, status, created_at, updated_at, metadata ]
        CustomerSummary:
            type: object
            description: Lightweight customer projection returned by list endpoints.
            properties:
                id:
                    type: string
                    description: Unique PaySaxas customer identifier.
                    example: cust_123456789
                type:
                    type: string
                    enum: [ individual, business ]
                    description: Customer type classification.
                    example: business
                status:
                    type: string
                    enum: [ inactive, reserved, active, closed ]
                    description: Current lifecycle status.
                    example: active
                country:
                    type: string
                    description: ISO 3166-1 alpha-2 country code.
                    example: DE
                created_at:
                    type: string
                    format: date-time
                    description: Creation timestamp (ISO 8601, UTC).
                    example: "2025-10-21T08:00:00Z"
                updated_at:
                    type: string
                    format: date-time
                    description: Last modification timestamp (ISO 8601, UTC).
                    example: "2025-10-23T11:45:00Z"
            required: [ id, type, status, created_at, updated_at ]
        CustomerMetadata:
            type: object
            description: Non-sensitive metadata used for CRM reconciliation.
            properties:
                created_by:
                    type: string
                    description: Source system that initiated or last updated the customer.
                    example: partner-portal-url
                client_reference:
                    type: string
                    description: Optional client-side reference linking internal systems.
                    example: crm-7890
            additionalProperties: false
        CustomerListResponse:
            type: object
            properties:
                data:
                    type: array
                    description: Customers included in the current page.
                    items:
                        $ref: '#/components/schemas/CustomerSummary'
                pagination:
                    $ref: '#/components/schemas/Pagination'
            required: [ data, pagination ]
        Pagination:
            type: object
            description: Cursor-based pagination metadata.
            properties:
                next_cursor:
                    type: string
                    description: Token to retrieve the next page of results.
                    example: eyJwYWdlIjoyfQ==
                limit:
                    type: integer
                    description: Number of results requested per page.
                    example: 20
            required: [ limit ]
        CustomerCreateRequest:
            type: object
            required: [ type, email ]
            properties:
                type:
                    type: string
                    enum: [ individual, business ]
                    description: Customer type.
                    example: business
                email:
                    type: string
                    format: email
                    description: Unique email address used for registration and communication.
                    example: ops@acme.example
                reference_id:
                    type: string
                    description: External partner reference such as a CRM or affiliate identifier.
                    example: ext-ACME001
                metadata:
                    $ref: '#/components/schemas/CustomerMetadata'
        CustomerMetadataUpdateRequest:
            type: object
            required: [ metadata ]
            properties:
                metadata:
                    $ref: '#/components/schemas/CustomerMetadata'
        WebhookIdentifierPayload:
            type: object
            description: Minimal webhook payload containing the related entity identifier.
            properties:
                id:
                    type: string
                    description: Unique identifier of the entity referenced by the webhook.
                    example: cust_123456789
            required: [ id ]
        ErrorResponse:
            type: object
            properties:
                error_name:
                    type: string
                    description: Machine readable error name.
                    example: Validation Error
                error_description:
                    type: string
                    description: Human readable error detail.
                    example: Invalid status filter.
                metadata:
                    type: object
                    description: Diagnostic metadata accompanying the error.
                    properties:
                        trace_id:
                            type: string
                            description: Unique trace identifier for debugging purposes.
                            example: abc123
                        details:
                            type: string
                            description: Optional extended context.
                    required: [ trace_id ]
            required: [ error_name, error_description ]
paths:
    /customers/{id}:
        get:
            summary: Retrieve Customer Details
            description: >
                Retrieves the full details of a specific customer by ID, including lifecycle stage,
                verification status, and metadata.  
                This endpoint is **read-only** — it does not allow modifications to customer data or lifecycle state.  
                Lifecycle transitions depend on internal onboarding flow and compliance checks.
            operationId: getCustomerById
            tags:
                - Customers
            parameters:
                -
                    name: id
                    in: path
                    required: true
                    description: Unique PaySaxas customer identifier.
                    schema:
                        type: string
                        example: cust_123456789
            security:
                -
                    bearerAuth: [ ]
            responses:
                "200":
                    description: Successful response with customer details.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    type:
                                        type: string
                                        enum: [ individual, business ]
                                        description: Defines customer type.
                                        example: individual
                                    reference_id:
                                        type: string
                                        description: External partner reference (e.g., CRM or affiliate system).
                                        example: ext-12345
                                    status:
                                        type: string
                                        description: Customer lifecycle status.
                                        enum: [ inactive, reserved, active, closed ]
                                        example: active
                                    created_at:
                                        type: string
                                        format: date-time
                                        description: Timestamp when the customer record was created (ISO 8601, UTC).
                                        example: "2025-10-21T08:00:00Z"
                                    updated_at:
                                        type: string
                                        format: date-time
                                        description: Timestamp of the last modification (ISO 8601, UTC).
                                        example: "2025-10-23T11:45:00Z"
                                    metadata:
                                        type: object
                                        description: Internal metadata for reference and traceability.
                                        properties:
                                            created_by:
                                                type: string
                                                description: Source system where customer was initially registered.
                                                example: partner-portal-url
                "400":
                    description: Validation Error — the provided ID does not match the expected pattern.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Validation Error
                                    error_description:
                                        type: string
                                        example: Invalid customer ID format.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                description: Unique internal trace identifier for debugging.
                                                example: abc123
                                            details:
                                                type: string
                                                description: Extended validation details.
                                                example: "Field 'id' must match pattern 'cust_[0-9]{9}'"
                "401":
                    description: Unauthorized — authentication token missing or expired.
                "403":
                    description: Insufficient Permissions — token lacks required access scope.
                "404":
                    description: Customer Not Found — no customer with the given ID exists or has been deleted.
            x-notes:
                - Endpoint is read-only.
                - All transitions are handled internally via system logic and compliance.
                - trace_id is included in all error responses for debugging and log correlation.
                - Example IDs and metadata are fictional placeholders.
        patch:
            summary: Update Customer Metadata
            description: >
                Updates the `metadata` object for a specific customer.  
                This endpoint does **not** change lifecycle `status`, onboarding stage, or any personal/KYC/KYB data.  
                The response mirrors the canonical customer shape used by POST /customers.
            operationId: updateCustomerMetadata
            tags:
                - Customers
            security:
                -
                    bearerAuth: [ ]
            parameters:
                -
                    name: id
                    in: path
                    required: true
                    description: Unique PaySaxas customer ID.
                    schema:
                        type: string
                        example: cust_123456789
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - metadata
                            properties:
                                metadata:
                                    type: object
                                    description: >
                                        Non-sensitive internal metadata.  
                                        **Only** the keys listed below are accepted for updates to keep parity with POST /customers.
                                    properties:
                                        created_by:
                                            type: string
                                            description: Source system that initiated or updated the registration.
                                            example: partner-portal-url
                                        client_reference:
                                            type: string
                                            description: Optional client-side reference for linking internal systems.
                                            example: crm-7890
                                    additionalProperties: false
            responses:
                "200":
                    description: Customer metadata successfully updated.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    id:
                                        type: string
                                        description: Unique PaySaxas customer identifier.
                                        example: cust_123456789
                                    type:
                                        type: string
                                        enum: [ individual, business ]
                                        description: Customer type.
                                        example: business
                                    reference_id:
                                        type: string
                                        description: External partner or CRM reference.
                                        example: ext-ACME001
                                    email:
                                        type: string
                                        format: email
                                        description: Customer email.
                                        example: ops@acme.example
                                    status:
                                        type: string
                                        description: Lifecycle stage.
                                        example: pre_registration
                                    created_at:
                                        type: string
                                        format: date-time
                                        description: Creation timestamp (ISO 8601, UTC).
                                        example: "2025-10-21T08:00:00Z"
                                    updated_at:
                                        type: string
                                        format: date-time
                                        description: Timestamp of the latest update (ISO 8601, UTC).
                                        example: "2025-10-24T12:45:00Z"
                                    metadata:
                                        type: object
                                        description: Latest metadata after the update.
                                        properties:
                                            created_by:
                                                type: string
                                                example: partner-portal-url
                                            client_reference:
                                                type: string
                                                example: crm-7890
                "400":
                    description: Validation Error — invalid body or forbidden fields provided.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Validation Error
                                    error_description:
                                        type: string
                                        example: Invalid metadata structure.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: abc123
                                            details:
                                                type: string
                                                example: "Field 'metadata' is required and must be an object. Only 'created_by' and 'client_reference' are allowed."
                "401":
                    description: Unauthorized — authentication token missing or expired.
                "403":
                    description: Insufficient Permissions — token lacks required access scope.
                "404":
                    description: Customer Not Found — no customer with the given ID exists.
                "409":
                    description: Conflict — concurrent update detected; retry with the latest state.
            x-notes:
                - Only `metadata` may be modified by this endpoint.
                - Lifecycle fields (`status`, onboarding stage) and any KYC/KYB or personal data are out of scope.
                - Response shape is aligned with POST /customers for consistency.
                - All updates are auditable (timestamp + operator identity).
    /customers:
        get:
            summary: List / Search Customers
            description: >
                Returns a paginated list of customers.  
                Use this endpoint to view active or pending customers, monitor onboarding progress, or build CRM/back-office dashboards.  
                Returned objects are **simplified** — for full details, use **GET /customers/\{id\}**.  
                Lifecycle transitions depend on internal onboarding flow and compliance rules.
            operationId: listCustomers
            tags:
                - Customers
            parameters:
                -
                    name: type
                    in: query
                    required: false
                    description: Filter by customer type.
                    schema:
                        type: string
                        enum: [ individual, business ]
                        example: business
                -
                    name: status
                    in: query
                    required: false
                    description: Filter by lifecycle stage.
                    schema:
                        type: string
                        enum: [ inactive, reserved, active, closed ]
                        example: active
                -
                    name: country
                    in: query
                    required: false
                    description: ISO 3166-1 alpha-2 country code.
                    schema:
                        type: string
                        example: DE
                -
                    name: cursor
                    in: query
                    required: false
                    description: >
                        Cursor token for pagination.  
                        Use `next_cursor` from the previous response to fetch the next page.  
                        **Offset-based pagination is not supported.**
                    schema:
                        type: string
                        example: eyJwYWdlIjoyfQ==
                -
                    name: limit
                    in: query
                    required: false
                    description: >
                        Optional page size parameter (used only with cursor-based pagination).  
                        Default: 20, Max: 100.
                    schema:
                        type: integer
                        example: 20
            security:
                -
                    bearerAuth: [ ]
            responses:
                "200":
                    description: Successful response with paginated list of customers.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    data:
                                        type: array
                                        description: List of customer objects on the current page.
                                        items:
                                            type: object
                                            properties:
                                                id:
                                                    type: string
                                                    description: Unique PaySaxas customer ID.
                                                    example: cust_123456789
                                                type:
                                                    type: string
                                                    enum: [ individual, business ]
                                                    description: Customer type.
                                                    example: business
                                                status:
                                                    type: string
                                                    enum: [ inactive, reserved, active, closed ]
                                                    description: Current customer lifecycle status.
                                                    example: active
                                                country:
                                                    type: string
                                                    description: ISO 3166-1 alpha-2 country code.
                                                    example: DE
                                                created_at:
                                                    type: string
                                                    format: date-time
                                                    description: Creation timestamp (ISO 8601, UTC).
                                                    example: "2025-10-21T08:00:00Z"
                                                updated_at:
                                                    type: string
                                                    format: date-time
                                                    description: Last modification timestamp (ISO 8601, UTC).
                                                    example: "2025-10-23T11:45:00Z"
                                    pagination:
                                        type: object
                                        description: Pagination metadata for cursor-based pagination.
                                        properties:
                                            next_cursor:
                                                type: string
                                                description: Token for the next page.
                                                example: eyJwYWdlIjoyfQ==
                                            limit:
                                                type: integer
                                                description: Number of results per page.
                                                example: 10
                "400":
                    description: Validation Error — one or more query parameters are invalid or unsupported.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Validation Error
                                    error_description:
                                        type: string
                                        example: Invalid status filter.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                description: Unique internal trace identifier for debugging.
                                                example: abc123
                                            details:
                                                type: string
                                                description: Additional context on the validation issue.
                                                example: "Allowed values: inactive, reserved, active, closed"
                "401":
                    description: Unauthorized — authentication token missing or expired.
                "403":
                    description: Insufficient Permissions — token lacks required access scope.
            x-notes:
                - This endpoint is read-only and cannot modify customer states.
                - Only cursor-based pagination is supported.
                - Always use `next_cursor` from the previous response to retrieve the next page.
                - If no filters are provided, results are returned in descending order by creation date.
                - trace_id is included in all error responses for diagnostics.
                - All example data are fictional placeholders.
        post:
            summary: Create a Customer
            description: >
                Creates a new customer record — either **individual** or **business** — and initializes its lifecycle
                in the `pre_registration` stage.  
                This is the first step of the customer onboarding process.  
                After creation, lifecycle transitions are handled internally:
                  * **Individuals** progress automatically (system-driven flow).
                  * **Businesses** progress manually through compliance review in the back office.  
                ⚠️ This endpoint does **not** accept or expose any KYC/KYB data.
            operationId: createCustomer
            tags:
                - Customers
            security:
                -
                    bearerAuth: [ ]
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            type: object
                            required:
                                - type
                                - email
                            properties:
                                type:
                                    type: string
                                    description: Customer type.
                                    enum: [ individual, business ]
                                    example: business
                                email:
                                    type: string
                                    format: email
                                    description: Unique customer email address (used for registration and communication).
                                    example: ops@acme.example
                                reference_id:
                                    type: string
                                    description: External partner reference (e.g., CRM or affiliate ID).
                                    example: ext-ACME001
                                metadata:
                                    type: object
                                    description: Non-sensitive metadata used for CRM or reconciliation.
                                    properties:
                                        created_by:
                                            type: string
                                            description: Source system that initiated registration.
                                            example: partner-portal-url
                                        client_reference:
                                            type: string
                                            description: Optional client-side reference for linking internal systems.
                                            example: crm-7890
            responses:
                "201":
                    description: Customer successfully created.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    id:
                                        type: string
                                        description: Unique PaySaxas customer identifier.
                                        example: cust_123456789
                                    type:
                                        type: string
                                        enum: [ individual, business ]
                                        description: Defines customer type.
                                        example: business
                                    reference_id:
                                        type: string
                                        description: External partner or CRM reference.
                                        example: ext-ACME001
                                    email:
                                        type: string
                                        description: Customer email.
                                        example: ops@acme.example
                                    status:
                                        type: string
                                        description: Lifecycle stage — starts as `pre_registration`.
                                        example: pre_registration
                                    created_at:
                                        type: string
                                        format: date-time
                                        description: Creation timestamp (ISO 8601, UTC).
                                        example: "2025-10-21T08:00:00Z"
                                    updated_at:
                                        type: string
                                        format: date-time
                                        description: Last modification timestamp (ISO 8601, UTC).
                                        example: "2025-10-21T08:00:00Z"
                                    metadata:
                                        type: object
                                        description: Non-sensitive internal metadata.
                                        properties:
                                            created_by:
                                                type: string
                                                example: partner-portal-url
                                            client_reference:
                                                type: string
                                                example: crm-7890
                "400":
                    description: Validation Error — missing or invalid required fields.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Validation Error
                                    error_description:
                                        type: string
                                        example:
                                            Missing required field: email
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: abc123
                                            details:
                                                type: string
                                                example: "Field 'email' is mandatory"
                "401":
                    description: Unauthorized — authentication token missing or expired.
                "403":
                    description: Insufficient Permissions — token lacks required access scope.
                "409":
                    description: Duplicate Customer — a record with the same email already exists.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Duplicate Customer
                                    error_description:
                                        type: string
                                        example: Customer with this email already exists
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: xyz321
            x-notes:
                - The created customer always starts in the `pre_registration` lifecycle stage.
                - The `status` field is read-only and controlled internally.
                - No KYC/KYB data are accepted.
                - Use unique `reference_id` and/or `metadata.client_reference` for reconciliation across CRM systems.
                - Example data are fictional placeholders.
    /transactions/{id}:
        get:
            summary: Retrieve Transaction Details
            description: >
                Returns read-only details of a specific transaction.  
                Provider-specific states are abstracted to a unified lifecycle: pending, processing, completed, failed, reversed.  
                Currency is always EUR.
            operationId: getTransactionById
            tags:
                - Transactions
            security:
                -
                    bearerAuth: [ ]
            parameters:
                -
                    name: id
                    in: path
                    required: true
                    description: Unique transaction identifier.
                    schema:
                        type: string
                        example: txn_345ab9
                -
                    name: X-Request-Id
                    in: header
                    required: false
                    description: Optional request identifier for trace correlation.
                    schema:
                        type: string
                        example: req_123e4567-e89b-12d3-a456-426614174000
            responses:
                "200":
                    description: Transaction details successfully retrieved.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    id:
                                        type: string
                                        description: Unique transaction identifier.
                                        example: txn_345ab9
                                    account_id:
                                        type: string
                                        description: Linked account ID.
                                        example: acc_782b4f
                                    type:
                                        type: string
                                        description: Direction of funds.
                                        enum: [ incoming, outgoing ]
                                        example: incoming
                                    amount:
                                        type: number
                                        description: Transaction amount in EUR.
                                        example: 2500.00
                                    currency:
                                        type: string
                                        description: Currency code (always EUR).
                                        enum: [ EUR ]
                                        example: EUR
                                    status:
                                        type: string
                                        description: Unified lifecycle status.
                                        enum: [ pending, processing, completed, failed, reversed ]
                                        example: completed
                                    reference:
                                        type: string
                                        description: External or internal payment reference.
                                        example: INV-2025-0032
                                    created_at:
                                        type: string
                                        format: date-time
                                        description: Timestamp of creation (ISO 8601, UTC).
                                        example: "2025-01-15T10:15:00Z"
                                    updated_at:
                                        type: string
                                        format: date-time
                                        description: Timestamp of last update (ISO 8601, UTC).
                                        example: "2025-01-15T10:30:00Z"
                                    metadata:
                                        type: object
                                        description: Optional internal metadata (e.g., internal_reference).
                                        properties:
                                            internal_reference:
                                                type: string
                                                example: SAFE_TXN_8471
                "400":
                    description: Validation Error — invalid transaction ID or malformed request.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name: { type: string, example: Validation Error }
                                    error_description: { type: string, example: Invalid transaction ID format. }
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id: { type: string, example: tr_12af61 }
                "401":
                    description: Unauthorized — missing or invalid authentication token.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name: { type: string, example: Unauthorized }
                                    error_description: { type: string, example: Missing or invalid authentication token. }
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id: { type: string, example: tr_7f22cc }
                "403":
                    description: Insufficient Permissions — scope `transactions:read` required.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name: { type: string, example: Insufficient Permissions }
                                    error_description: { type: string, example: Access denied — scope transactions:read required. }
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id: { type: string, example: tr_55af10 }
                "404":
                    description: Transaction Not Found — transaction does not exist or belongs to another customer.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name: { type: string, example: Transaction Not Found }
                                    error_description: { type: string, example: Transaction with ID txn_345ab9 not found or access is restricted. }
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id: { type: string, example: tr_5e71cb }
                "500":
                    description: Internal Error — unexpected server-side error.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name: { type: string, example: Internal Error }
                                    error_description: { type: string, example: Unexpected processing error. }
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id: { type: string, example: tr_82cb19 }
            x-notes:
                - Endpoint is read-only; transactions are immutable.
                - Provider-specific states are hidden; only the unified lifecycle is exposed.
                - Currency is fixed to EUR across all transactions.
    /transactions:
        get:
            summary: List Transactions
            description: >
                Returns a **cursor-paginated** list of transactions for the authenticated customer.  
                Provider-specific states are abstracted to a unified lifecycle: pending, processing, completed, failed, reversed.  
                Currency is always EUR.
            operationId: listTransactions
            tags:
                - Transactions
            security:
                -
                    bearerAuth: [ ]
            parameters:
                -
                    name: account_id
                    in: query
                    required: false
                    description: Filter by specific account ID.
                    schema:
                        type: string
                        example: acc_782b4f
                -
                    name: date_from
                    in: query
                    required: false
                    description: Start of date range (ISO 8601, UTC).
                    schema:
                        type: string
                        format: date-time
                        example: "2025-01-01T00:00:00Z"
                -
                    name: date_to
                    in: query
                    required: false
                    description: End of date range (ISO 8601, UTC).
                    schema:
                        type: string
                        format: date-time
                        example: "2025-01-31T23:59:59Z"
                -
                    name: type
                    in: query
                    required: false
                    description: Transaction direction.
                    schema:
                        type: string
                        enum: [ incoming, outgoing ]
                        example: incoming
                -
                    name: status
                    in: query
                    required: false
                    description: Unified lifecycle status.
                    schema:
                        type: string
                        enum: [ pending, processing, completed, failed, reversed ]
                        example: completed
                -
                    name: reference
                    in: query
                    required: false
                    description: Filter by external or internal reference.
                    schema:
                        type: string
                        example: INV-2025-0032
                -
                    name: cursor
                    in: query
                    required: false
                    description: Cursor token for the next page. Use `pagination.next_cursor` from the previous response.
                    schema:
                        type: string
                        example: eyJwYWdlIjoyfQ==
                -
                    name: limit
                    in: query
                    required: false
                    description:
                        Number of records per page. Default:25 Max 100.
                    schema:
                        type: integer
                        example: 25
                -
                    name: X-Request-Id
                    in: header
                    required: false
                    description: Optional request identifier for trace correlation.
                    schema:
                        type: string
                        example: req_123e4567-e89b-12d3-a456-426614174000
            responses:
                "200":
                    description: List of transactions successfully retrieved.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    data:
                                        type: array
                                        description: List of transaction objects.
                                        items:
                                            type: object
                                            properties:
                                                id:
                                                    type: string
                                                    description: Unique transaction identifier.
                                                    example: txn_345ab9
                                                account_id:
                                                    type: string
                                                    description: Linked account ID.
                                                    example: acc_782b4f
                                                type:
                                                    type: string
                                                    description: Direction of funds.
                                                    enum: [ incoming, outgoing ]
                                                    example: incoming
                                                amount:
                                                    type: number
                                                    description: Transaction amount in EUR.
                                                    example: 2500.00
                                                currency:
                                                    type: string
                                                    description: Currency code (always EUR).
                                                    enum: [ EUR ]
                                                    example: EUR
                                                status:
                                                    type: string
                                                    description: Unified lifecycle status.
                                                    enum: [ pending, processing, completed, failed, reversed ]
                                                    example: completed
                                                reference:
                                                    type: string
                                                    description: External or internal reference.
                                                    example: INV-2025-0032
                                                created_at:
                                                    type: string
                                                    format: date-time
                                                    description: Timestamp of creation (ISO 8601, UTC).
                                                    example: "2025-01-15T10:15:00Z"
                                    pagination:
                                        type: object
                                        description: Cursor pagination object.
                                        properties:
                                            limit:
                                                type: integer
                                                description: Current page size.
                                                example: 25
                                            next_cursor:
                                                type: string
                                                description: Opaque token for the next page (if available).
                                                example: eyJwYWdlIjoyfQ==
                                            has_more:
                                                type: boolean
                                                description: Whether more pages exist.
                                                example: true
                "204":
                    description: No transactions found for the specified filters.
                "400":
                    description: Validation Error — invalid filter parameter or date format.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Validation Error
                                    error_description:
                                        type: string
                                        example: Invalid filter parameter or date format.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_12af61
                "401":
                    description: Unauthorized — missing or invalid authentication token.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Unauthorized
                                    error_description:
                                        type: string
                                        example: Missing or invalid authentication token.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_7f22cc
                "403":
                    description: Insufficient Permissions — scope `transactions:read` required.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Insufficient Permissions
                                    error_description:
                                        type: string
                                        example: Access denied — scope transactions:read required.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_55af10
                "404":
                    description: Account Not Found — the specified account does not exist or is inactive.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Account Not Found
                                    error_description:
                                        type: string
                                        example: The specified account does not exist or is inactive.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_5e71cb
                "500":
                    description: Internal Error — unexpected server-side error.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Internal Error
                                    error_description:
                                        type: string
                                        example: Unexpected processing error.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_82cb19
            x-notes:
                - Cursor-based pagination only; offset pagination is not supported.
                - Transactions are immutable and read-only.
                - Provider-specific states are hidden; only the unified lifecycle is exposed.
                - Currency is fixed to EUR across all transactions.
    /accounts/{id}/ibans:
        get:
            summary: List vIBANs for an Account
            description: >
                Retrieves all **virtual IBANs (vIBANs)** linked to a specific verified account.  
                The endpoint is **read-only** and returns structural data only — no real financial identifiers or personal information.  
                Use it to display, reconcile, or manage account-linked identifiers safely.
            operationId: listIbansByAccount
            tags:
                - Accounts
            security:
                -
                    bearerAuth: [ ]
            parameters:
                -
                    name: id
                    in: path
                    required: true
                    description: Unique identifier of the parent account.
                    schema:
                        type: string
                        example: acc_782b4f
                -
                    name: cursor
                    in: query
                    required: false
                    description: Cursor token for pagination. Use `next_cursor` from the previous response.
                    schema:
                        type: string
                        example: eyJwYWdlIjoyfQ==
                -
                    name: limit
                    in: query
                    required: false
                    description:
                        Number of records per page. Default25. Max 100.
                    schema:
                        type: integer
                        example: 25
            responses:
                "200":
                    description: Successful response with list of IBANs.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    data:
                                        type: array
                                        description: List of vIBAN objects linked to the account.
                                        items:
                                            type: object
                                            properties:
                                                iban:
                                                    type: string
                                                    description: Finnish-format vIBAN (masked example).
                                                    example: FI2112345600000785
                                                bic:
                                                    type: string
                                                    description: BIC of issuing bank (masked example).
                                                    example: PAYSA0XXX
                                                currency:
                                                    type: string
                                                    description: Account currency (always "EUR").
                                                    example: EUR
                                                status:
                                                    type: string
                                                    enum: [ active, reserved, closed ]
                                                    description: IBAN lifecycle status.
                                                    example: active
                                                created_at:
                                                    type: string
                                                    format: date-time
                                                    description: Timestamp of issuance (ISO 8601, UTC).
                                                    example: "2025-01-15T10:00:00Z"
                                    pagination:
                                        type: object
                                        description: Cursor pagination object.
                                        properties:
                                            limit:
                                                type: integer
                                                description: Number of records per page.
                                                example: 25
                                            next_cursor:
                                                type: string
                                                description: Token for next page (if available).
                                                example: eyJwYWdlIjoyfQ==
                "400":
                    description: Validation Error — invalid account ID or query parameters.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Validation Error
                                    error_description:
                                        type: string
                                        example: Invalid account ID format.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: abc123
                "401":
                    description: Unauthorized — missing or invalid access token.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Unauthorized
                                    error_description:
                                        type: string
                                        example: Invalid or expired access token.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: def456
                "403":
                    description: Insufficient Permissions — scope `ibans:read` required.
                "404":
                    description: Account Not Found — account not found or inactive.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Account Not Found
                                    error_description:
                                        type: string
                                        example: Account ID not found or inactive.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: xyz987
                "500":
                    description: Internal Error — unexpected processing issue.
            x-notes:
                - Endpoint is read-only and idempotent.
                - Accessible only for verified accounts linked to the authenticated user.
                - Supports cursor-based pagination only (no offset pagination).
                - All IBANs are tokenized; examples provided are safe mock values.
                - Each call is logged with timestamp, operator ID, and source IP.
                - Use `GET /accounts/{id}` to retrieve associated account details.
    /accounts/{id}:
        get:
            summary: Retrieve Account Details
            description: >
                Retrieves detailed information about a specific account, including its currency, balances, type, and lifecycle status.  
                No sensitive or personally identifiable information (PII) is ever returned.  
                This endpoint is used for account monitoring, reconciliation, and balance validation within the verified PaySaxas ecosystem.
            operationId: getAccountById
            tags:
                - Accounts
            security:
                -
                    bearerAuth: [ ]
            parameters:
                -
                    name: id
                    in: path
                    required: true
                    description: Unique account identifier.
                    schema:
                        type: string
                        example: acc_782b4f
            responses:
                "200":
                    description: Successful response with account details.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    id:
                                        type: string
                                        description: Unique account identifier.
                                        example: acc_782b4f
                                    customer_id:
                                        type: string
                                        description: ID of the verified customer owning the account.
                                        example: cust_9f22ab7c
                                    currency:
                                        type: string
                                        description: Account currency (always EUR, ISO 4217).
                                        example: EUR
                                    account_type:
                                        type: string
                                        description: Account type.
                                        enum: [ individual, business ]
                                        example: individual
                                    balance:
                                        type: object
                                        description: Account balance details.
                                        properties:
                                            current:
                                                type: number
                                                description: Current total ledger balance.
                                                example: 12000.75
                                            available:
                                                type: number
                                                description: Funds currently available (after holds or pending operations).
                                                example: 11850.25
                                    status:
                                        type: string
                                        description: Current account lifecycle status.
                                        enum: [ inactive, reserved, active, closed ]
                                        example: active
                                    metadata:
                                        type: object
                                        description: Optional internal metadata (label, purpose, internal reference).
                                        properties:
                                            label:
                                                type: string
                                                example: EUR operational account
                                    created_at:
                                        type: string
                                        format: date-time
                                        description: Timestamp of account creation (ISO 8601, UTC).
                                        example: "2025-10-30T10:20:11Z"
                                    updated_at:
                                        type: string
                                        format: date-time
                                        description: Timestamp of the last update (ISO 8601, UTC).
                                        example: "2025-10-30T11:03:55Z"
                "400":
                    description: Validation Error — invalid account ID format.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Validation Error
                                    error_description:
                                        type: string
                                        example: Invalid account ID format.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_1f2a9b
                "401":
                    description: Unauthorized — missing or expired authentication token.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Unauthorized
                                    error_description:
                                        type: string
                                        example: Missing or expired authentication token.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_3f5c7e
                "403":
                    description: Insufficient Permissions — access denied, scope `accounts:read` required.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Insufficient Permissions
                                    error_description:
                                        type: string
                                        example: Access denied — scope accounts:read required.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_7b1f5e
                "404":
                    description: Account Not Found — account does not exist or is inaccessible.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Account Not Found
                                    error_description:
                                        type: string
                                        example: Account does not exist or access denied.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_9a0b22
                "500":
                    description: Internal Error — unexpected server error.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Internal Error
                                    error_description:
                                        type: string
                                        example: Unexpected server error. Please retry or contact support.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_6d88f4
            x-notes:
                - Endpoint is read-only and idempotent.
                - All access events are logged with timestamp, operator ID, and source IP.
                - Responses never contain personal or financial identifiers.
                - Use `X-Request-Id` for request correlation and audit trail consistency.
                - Currency is fixed to EUR for all accounts and linked IBANs.
                - To retrieve linked vIBANs, use GET /accounts/{id}/ibans.
    /accounts:
        get:
            summary: List Accounts
            description: >
                Returns a **paginated** list of accounts associated with the authenticated, verified customer.  
                The response contains general account metadata only (no balances or IBANs).  
                Cursor-based pagination only — offset pagination is not supported.
            operationId: listAccounts
            tags:
                - Accounts
            security:
                -
                    bearerAuth: [ ]
            parameters:
                -
                    name: cursor
                    in: query
                    required: false
                    description: Cursor token for the next page. Use `pagination.next_cursor` from the previous response.
                    schema:
                        type: string
                        example: eyJwYWdlIjoyfQ==
                -
                    name: limit
                    in: query
                    required: false
                    description:
                        Number of records per page. Default25. Max 100.
                    schema:
                        type: integer
                        example: 25
            responses:
                "200":
                    description: List of accounts successfully retrieved.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    data:
                                        type: array
                                        description: List of account objects.
                                        items:
                                            type: object
                                            properties:
                                                id:
                                                    type: string
                                                    description: Unique account identifier.
                                                    example: acc_782b4f
                                                customer_id:
                                                    type: string
                                                    description: Associated verified customer ID.
                                                    example: cust_9f22ab7c
                                                currency:
                                                    type: string
                                                    description: Account currency (always EUR, ISO 4217).
                                                    example: EUR
                                                account_type:
                                                    type: string
                                                    description: Account type.
                                                    enum: [ individual, business ]
                                                    example: individual
                                                status:
                                                    type: string
                                                    description: Account lifecycle status.
                                                    enum: [ inactive, reserved, active, closed ]
                                                    example: active
                                                created_at:
                                                    type: string
                                                    format: date-time
                                                    description: Account creation timestamp (ISO 8601, UTC).
                                                    example: "2025-10-30T10:20:11Z"
                                    pagination:
                                        type: object
                                        description: Cursor pagination object.
                                        properties:
                                            limit:
                                                type: integer
                                                description: Current page size.
                                                example: 25
                                            next_cursor:
                                                type: string
                                                description: Opaque token for the next page (if available).
                                                example: eyJwYWdlIjoyfQ==
                "204":
                    description: No accounts found for this customer.
                "400":
                    description: Validation Error — invalid or unsupported query parameter.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Validation Error
                                    error_description:
                                        type: string
                                        example: Invalid query parameter.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_01ab99
                "401":
                    description: Unauthorized — missing or invalid access token.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Unauthorized
                                    error_description:
                                        type: string
                                        example: Access token invalid or expired.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_7f22cc
                "403":
                    description: Insufficient Permissions — scope `accounts:read` required.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Insufficient Permissions
                                    error_description:
                                        type: string
                                        example: Missing scope accounts:read.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_55af10
                "500":
                    description: Internal Error — unexpected processing error.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Internal Error
                                    error_description:
                                        type: string
                                        example: Unexpected processing error.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_93aa21
            x-notes:
                - Cursor-based pagination only; offset pagination is not supported.
                - Endpoint is read-only and idempotent.
                - Currency is fixed to EUR across all accounts.
                - Responses contain no balances or IBANs; use dedicated endpoints for those.
                - Use X-Request-Id for request correlation in logs.
        post:
            summary: Issue a New IBAN
            description: >
                Creates a new **IBAN** linked to the specified account.  
                Each IBAN shares the same ledger balance as its parent account.  
                All compliance, currency, and operational rules of the parent account apply to its IBANs.
            operationId: issueNewIban
            tags:
                - Accounts
            security:
                -
                    bearerAuth: [ ]
            parameters:
                -
                    name: id
                    in: path
                    required: true
                    description: Unique ID of the parent account.
                    schema:
                        type: string
                        example: acc_782b4f
            requestBody:
                required: false
                content:
                    application/json:
                        schema:
                            type: object
                            properties:
                                metadata:
                                    type: object
                                    description: Optional metadata for internal references or labeling (no personal data allowed).
                                    properties:
                                        label:
                                            type: string
                                            example: Marketing campaign IBAN
                                        reference:
                                            type: string
                                            example: CAMP-001
                                        purpose:
                                            type: string
                                            example: Inbound SEPA for campaign
            responses:
                "201":
                    description: IBAN successfully issued and active.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    iban:
                                        type: string
                                        description: Finnish-format IBAN (example only, not real).
                                        example: FI2112345600000785
                                    bic:
                                        type: string
                                        description: BIC of the issuing institution (masked example).
                                        example: PAYSA0XXX
                                    currency:
                                        type: string
                                        description: Always EUR (ISO 4217).
                                        example: EUR
                                    status:
                                        type: string
                                        description: Lifecycle status.
                                        enum: [ active, reserved, closed ]
                                        example: active
                                    created_at:
                                        type: string
                                        format: date-time
                                        description: Timestamp when the IBAN was issued (ISO 8601, UTC).
                                        example: "2025-01-15T10:00:00Z"
                "202":
                    description: IBAN issuance is being processed asynchronously.
                "400":
                    description: Validation Error — invalid account ID or malformed payload.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Validation Error
                                    error_description:
                                        type: string
                                        example: Invalid account ID or unsupported payload.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_0f51a1
                "401":
                    description: Unauthorized — missing or invalid authentication token.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Unauthorized
                                    error_description:
                                        type: string
                                        example: Missing or invalid authentication token.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_7f22cc
                "403":
                    description: Insufficient Permissions — scope `ibans:write` required.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Insufficient Permissions
                                    error_description:
                                        type: string
                                        example: Scope ibans:write required.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_9fa512
                "404":
                    description: Account Not Found — parent account not found or inactive.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Account Not Found
                                    error_description:
                                        type: string
                                        example: Parent account not found or inactive.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_54cc92
                "409":
                    description: Duplicate IBAN — IBAN already exists for this account.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Duplicate IBAN
                                    error_description:
                                        type: string
                                        example: IBAN already exists for this account.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_7ae2d0
                "500":
                    description: Internal Error — unexpected server-side error.
                    content:
                        application/json:
                            schema:
                                type: object
                                properties:
                                    error_name:
                                        type: string
                                        example: Internal Error
                                    error_description:
                                        type: string
                                        example: Unexpected processing error.
                                    metadata:
                                        type: object
                                        properties:
                                            trace_id:
                                                type: string
                                                example: tr_82cb19
            x-notes:
                - Each IBAN belongs to one parent account and shares its ledger balance.
                -
                    IBANs may be closed (status: closed) but never deleted.
                - Always include `X-Request-Id` (UUIDv4) for idempotency; repeated requests with the same ID return the same object.
                - All issuance operations are logged with timestamp, operator ID, and source IP.
                - All IBAN and BIC values are masked in examples; real identifiers are tokenized and encrypted.
                - The `metadata` field must not contain any personal or sensitive data.
                - Currency is fixed to EUR for all accounts and issued IBANs.
webhooks:
    accounts_ibans:
        post:
            summary: Accounts & IBANs Webhooks
            description: >
                Webhooks deliver real-time notifications about account and IBAN events.  
                The payload is intentionally minimal — the body contains only the entity `id`.  
                The event type is provided via the `X-Event` header.  
                After receiving a webhook, always fetch details via the relevant GET endpoint.
            operationId: deliverAccountsIbanWebhook
            tags:
                - Accounts
            security:
                -
                    HMACSignature: [ ]
            parameters:
                - $ref: '#/components/parameters/AccountsXEventHeader'
                - $ref: '#/components/parameters/XSignatureHeader'
                - $ref: '#/components/parameters/XRequestIdHeader'
                - $ref: '#/components/parameters/DateHeader'
                - $ref: '#/components/parameters/JsonContentTypeHeader'
            requestBody:
                description: Minimal JSON body containing only the related entity identifier.
                required: true
                content:
                    application/json:
                        schema:
                            allOf:
                                - $ref: '#/components/schemas/WebhookIdentifierPayload'
                            description: >
                                Unique identifier of the related entity.  
                                For account events — account ID.  
                                For IBAN events — account ID (IBAN details must be fetched separately).
            responses:
                "200":
                    description: Successful delivery acknowledgment.
                "204":
                    description: Successful delivery acknowledgment with no response body.
                "400":
                    description: Invalid payload or malformed signature.
                "401":
                    description: Unauthorized — missing or invalid signature.
                "403":
                    description: Forbidden — timestamp outside the allowed window or signature validation failed.
                "5xx":
                    description: Temporary server error — webhook will be retried.
            x-events:
                -
                    name: account.created
                    description: New account created and activated.
                    fetch: GET /accounts/{id}
                -
                    name: account.reserved
                    description: Account structure reserved (not yet active).
                    fetch: GET /accounts/{id}
                -
                    name: account.status.changed
                    description: Lifecycle change (inactive → reserved → active → closed).
                    fetch: GET /accounts/{id}
                -
                    name: account.closed
                    description: Account closed (offboarding).
                    fetch: GET /accounts/{id}
                -
                    name: balance.changed
                    description: Account balance updated after posting.
                    fetch: GET /accounts/{id}
                -
                    name: iban.issued
                    description: A new IBAN issued under the account.
                    fetch: GET /accounts/{id}/ibans
                -
                    name: iban.updated
                    description: IBAN metadata or status changed.
                    fetch: GET /accounts/{id}/ibans
            x-delivery:
                transport: HTTPS (TLS 1.2+)
                headers:
                    - name: X-Event
                      required: true
                      example: account.created
                      description: Event type (not present in body).
                    - name: X-Signature
                      required: true
                      example: sha256=5f2a4d9e...
                      description: HMAC SHA-256 signature of the raw body using the shared secret.
                    - name: X-Request-Id
                      required: true
                      example: req_9a7c4e2f
                      description: UUIDv4 used for deduplication and idempotency.
                    - name: Date
                      required: true
                      example: Wed, 05 Nov 2025 12:45:30 GMT
                      description: Timestamp for replay protection (reject if skew > 5 minutes).
                    - name: Content-Type
                      required: true
                      example: application/json
                      description: Always JSON.
            x-examples:
                -
                    title: Account created
                    headers:
                        X-Event: account.created
                        X-Signature: sha256=f28b1e7c4df9...
                        X-Request-Id: req_9a7c4e2f
                        Date: Wed, 05 Nov 2025 12:45:30 GMT
                        Content-Type: application/json
                    body:
                        id: acc_782b4f
                -
                    title: Balance changed
                    headers:
                        X-Event: balance.changed
                    body:
                        id: acc_782b4f
                -
                    title: IBAN issued
                    headers:
                        X-Event: iban.issued
                    body:
                        id: acc_782b4f
            x-acknowledgement:
                description: >
                    The receiver must return a 2xx HTTP status within 5 seconds to acknowledge the event.  
                    If no 2xx response is received, retries will occur up to 3 times within 24 hours using exponential backoff.
                success_codes:
                    - 200
                    - 201
                    - 202
                    - 204
                retry_policy:
                    max_attempts: 3
                    interval_strategy: exponential
                    total_window: 24h
                deduplication:
                    description: >
                        Each webhook includes a unique `X-Request-Id`.  
                        Receivers must deduplicate events by storing and checking this value.  
                        Processing the same webhook multiple times must not affect system state.
            x-security-notes:
                - Webhook bodies contain only identifiers — no PII, balances, or provider data.
                - Verify `X-Signature` and reject requests with invalid signatures.
                - Reject requests with `Date` skew greater than 5 minutes to prevent replay attacks.
                - Use `X-Event` to determine the entity type, then fetch details via the corresponding GET endpoint.
                - Require HTTPS (TLS 1.2+) for all webhook URLs.
                - Maintain an internal store of processed `X-Request-Id` values for deduplication.
                - Avoid logging full headers or signatures in plain text.
                - Handle webhook retries idempotently — processing the same event twice must not create duplicate records.
    transactions:
        post:
            summary: Transaction Events Webhooks
            description: >
                Webhooks deliver real-time notifications about transaction lifecycle changes.  
                Each webhook contains only the transaction `id` in its body,  
                and the event type is provided via the `X-Event` header.  
                After receiving a webhook, clients must fetch the full transaction details via `GET /transactions/{id}`.
            operationId: deliverTransactionWebhook
            tags:
                - Transactions
            security:
                -
                    HMACSignature: [ ]
            parameters:
                - $ref: '#/components/parameters/TransactionsXEventHeader'
                - $ref: '#/components/parameters/XSignatureHeader'
                - $ref: '#/components/parameters/XRequestIdHeader'
                - $ref: '#/components/parameters/DateHeader'
                - $ref: '#/components/parameters/JsonContentTypeHeader'
            requestBody:
                description: Minimal JSON body containing only the transaction identifier.
                required: true
                content:
                    application/json:
                        schema:
                            allOf:
                                - $ref: '#/components/schemas/WebhookIdentifierPayload'
                            description: Unique identifier of the affected transaction.
            responses:
                "200":
                    description: Successful delivery acknowledgment.
                "204":
                    description: Successful delivery acknowledgment with no response body.
                "400":
                    description: Invalid payload or malformed signature.
                "401":
                    description: Unauthorized — missing or invalid signature.
                "403":
                    description: Forbidden — timestamp outside the allowed window or signature validation failed.
                "5xx":
                    description: Temporary server error — webhook will be retried.
            x-events:
                -
                    name: transaction.created
                    description: A new transaction has been registered.
                    fetch: GET /transactions/{id}
                -
                    name: transaction.processing
                    description: Transaction is currently being processed by payment rails.
                    fetch: GET /transactions/{id}
                -
                    name: transaction.completed
                    description: Transaction has been successfully settled.
                    fetch: GET /transactions/{id}
                -
                    name: transaction.failed
                    description: Transaction has failed or was rejected.
                    fetch: GET /transactions/{id}
                -
                    name: transaction.reversed
                    description: Transaction has been reversed or refunded.
                    fetch: GET /transactions/{id}
            x-delivery:
                transport: HTTPS (TLS 1.2+)
                headers:
                    - name: X-Event
                      required: true
                      example: transaction.completed
                      description: Event type (not included in body).
                    - name: X-Signature
                      required: true
                      example: sha256=5f2a4d9e...
                      description: HMAC SHA-256 signature of the raw body using the shared secret.
                    - name: X-Request-Id
                      required: true
                      example: req_9a7c4e2f
                      description: UUIDv4 used for deduplication and idempotency.
                    - name: Date
                      required: true
                      example: Wed, 05 Nov 2025 12:45:30 GMT
                      description: Timestamp for replay protection (reject if skew > 5 minutes).
                    - name: Content-Type
                      required: true
                      example: application/json
                      description: Always JSON.
            x-examples:
                -
                    title: Transaction created
                    headers:
                        X-Event: transaction.created
                        X-Signature: sha256=f28b1e7c4df9...
                        X-Request-Id: req_9a7c4e2f
                        Date: Wed, 05 Nov 2025 12:45:30 GMT
                        Content-Type: application/json
                    body:
                        id: txn_00231a
                -
                    title: Transaction completed
                    headers:
                        X-Event: transaction.completed
                    body:
                        id: txn_00231a
                -
                    title: Transaction failed
                    headers:
                        X-Event: transaction.failed
                    body:
                        id: txn_00231a
            x-acknowledgement:
                description: >
                    Respond with any 2xx HTTP code within 5 seconds to acknowledge delivery.  
                    If no 2xx response is received, the system retries up to 3 times within 24 hours using exponential backoff.
                success_codes:
                    - 200
                    - 201
                    - 202
                    - 204
                retry_policy:
                    max_attempts: 3
                    interval_strategy: exponential
                    total_window: 24h
                deduplication:
                    description: >
                        Each webhook includes a unique `X-Request-Id`.  
                        Receivers must deduplicate events by storing and checking this value.  
                        Processing the same webhook multiple times must not affect state.
            x-delivery-best-practices:
                - Webhooks are delivered sequentially per entity to preserve order.
                - Acknowledge quickly and process asynchronously.
                - Always verify the `X-Signature` using your stored secret.
                - Reject if the `Date` header skew exceeds 5 minutes.
                - Use `X-Event` to route processing logic, then fetch transaction details.
            x-security-notes:
                - Body includes only identifiers — no PII, balances, or financial data.
                - TLS 1.2+ is mandatory for all webhook endpoints.
                - Maintain a store of processed `X-Request-Id` values for deduplication.
                - Do not log full payloads or signatures in plain text.
                - Verify the authenticity of each webhook before processing.
    customers:
        post:
            summary: Customer Webhooks
            description: >
                Webhooks notify your system about customer lifecycle events such as creation, status changes, or suspension.  
                Each webhook delivers a **minimal payload containing only the customer ID**.  
                The event type is passed exclusively via the `X-Event` header for security and consistency.  
                For full customer details, always call **GET /customers/\{id\}** after receiving the webhook.
            operationId: deliverCustomerWebhook
            tags:
                - Customers
            security:
                -
                    HMACSignature: [ ]
            parameters:
                - $ref: '#/components/parameters/CustomersXEventHeader'
                - $ref: '#/components/parameters/XSignatureHeader'
                - $ref: '#/components/parameters/XRequestIdHeader'
                - $ref: '#/components/parameters/DateHeader'
                - $ref: '#/components/parameters/JsonContentTypeHeader'
            requestBody:
                required: true
                content:
                    application/json:
                        schema:
                            allOf:
                                - $ref: '#/components/schemas/WebhookIdentifierPayload'
                            description: Unique PaySaxas customer identifier.
            responses:
                "200":
                    description: Successful delivery acknowledgment.
                "204":
                    description: Successful delivery acknowledgment with no response body.
                "400":
                    description: Invalid payload or malformed signature.
                "401":
                    description: Unauthorized — missing or invalid signature.
                "403":
                    description: Forbidden — invalid timestamp or failed signature validation.
                "5xx":
                    description: Temporary server error — webhook will be retried.
            x-examples:
                -
                    summary: customer.created
                    value:
                        headers:
                            X-Event: customer.created
                            X-Signature: sha256=f28b1e7c4df9...
                            X-Request-Id: req_9a7c4e2f
                            Date: Wed, 05 Nov 2025 12:45:30 GMT
                            Content-Type: application/json
                        body:
                            id: cust_123456789
                -
                    summary: customer.status.changed
                    value:
                        headers:
                            X-Event: customer.status.changed
                            X-Signature: sha256=ad6b4d8fca7a...
                            X-Request-Id: req_b481aa94
                            Date: Wed, 05 Nov 2025 13:10:02 GMT
                            Content-Type: application/json
                        body:
                            id: cust_987654321
                -
                    summary: customer.suspended
                    value:
                        headers:
                            X-Event: customer.suspended
                            X-Signature: sha256=bea7938c9a10...
                            X-Request-Id: req_73fcd832
                            Date: Wed, 05 Nov 2025 13:40:00 GMT
                            Content-Type: application/json
                        body:
                            id: cust_456789123
            x-delivery:
                retries: 3
                retry_window: 24h
                backoff_strategy: exponential
                success_statuses: [ 200, 204 ]
            x-notes:
                - Payloads always contain only the `id` field.
                - Event type is always sent in the `X-Event` header.
                - Responses must be returned within 5 seconds.
                - If no 2xx response is received, delivery is retried up to 3 times within 24 hours.
                - Use `X-Request-Id` for deduplication.
                - Always verify `X-Signature` and the `Date` header to prevent spoofing or replay attacks.
                - Webhooks never include personal, financial, or KYC/KYB data.
                - Always call `GET /customers/\{id\}` after receiving a webhook to fetch full customer data.
